// Generated by CoffeeScript 1.9.3
(function() {
  var $, filter_list;

  $ = jQuery;

  filter_list = function(val) {
    var rex;
    rex = new RegExp(val, "i");
    $(".searchable li").hide();
    $(".searchable li").parent().parent('.list_hide_segment').hide();
    $(".searchable li").filter(function() {
      return rex.test($(this).text());
    }).show();
    return $(".searchable li").filter(function() {
      return rex.test($(this).text());
    }).parent().parent().show();
  };

  $("input.filter-list").on("keyup", function(e) {
    var ev;
    if (e.keyCode === 27) {
      $(e.currentTarget).val("");
      ev = $.Event("keyup");
      ev.keyCode = 13;
      $(e.currentTarget).trigger(ev);
      return e.currentTarget.blur();
    } else {
      return filter_list($(this).val());
    }
  });

  $("input.filter-list").ready(function() {
    var elem, val;
    elem = $("input.filter-list");
    elem.focus();
    val = elem.val();
    filter_list(val);
    return elem.val('').val(val);
  });

}).call(this);

// Add function to easily get URL params
$.urlParam = function(name){
  var results = new RegExp('[\?&]' + name + '=([^&#]*)').exec(window.location.href);
  if (results==null){
    return null;
  }
  else{
    return decodeURI(results[1]) || 0;
  }
}

// On startup if url param sort is set replace default sort
if($.urlParam('sort')) {
  $('.default-sort').removeClass('default-sort');
  $("th:contains('"+$.urlParam('sort')+"')").addClass('default-sort');
}

// When a table header is clicked update the URL without refreshing page
$( "th" ).click(function() {
  var newUrl = location.origin + location.pathname + "?sort=" + $(this).text();
  history.pushState({}, null, newUrl);
});
